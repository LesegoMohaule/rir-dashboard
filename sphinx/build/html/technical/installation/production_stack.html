
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Production Stack &#8212; RIR Dashboard 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RIR Roadmap" href="../../roadmap.html" />
    <link rel="prev" title="Initial Configuration" href="initial_configuration.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="production-stack">
<h1>Production Stack<a class="headerlink" href="#production-stack" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this section we will bring up the full production stack, but to do that we first need to get an SSL certificate issued. To facilitate this, there is a special, simplified, version of Nginx which has no reverse proxies in place and not docker dependencies. Here is an overview of the process:</p>
<ol class="simple">
<li><p>Replace the domain name in your letsencrypt init script</p></li>
<li><p>Replace the email address in your letsencrypt init script</p></li>
<li><p>Replace the domain name in the certbot init nginx config file</p></li>
<li><p>Open up ports 80 and 443 on your firewall</p></li>
<li><p>Run the init script, ensuring it completed successfully</p></li>
<li><p>Shut down the minimal nginx</p></li>
<li><p>Replace the domain name in the production nginx config file</p></li>
<li><p>Generate passwords for geoserver, postgres, postgrest and update .env</p></li>
<li><p>Copy over the mapproxy template files</p></li>
<li><p>Run the production profile in docker compose</p></li>
</ol>
<p>At the end of the process you should have a fully running production stack with these services:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>IMAGE</p></th>
<th class="head"><p>PORTS</p></th>
<th class="head"><p>NAMES</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nginx:alpine</p></td>
<td><p>0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp</p></td>
<td><p>osgisstack_nginx_1</p></td>
</tr>
<tr class="row-odd"><td><p>quay.io/lkiesow/docker-scp</p></td>
<td><p>22/tcp</p></td>
<td><p>osgisstack_scp_1</p></td>
</tr>
<tr class="row-even"><td><p>kartoza/hugo-watcher:main</p></td>
<td><p>1313/tcp</p></td>
<td><p>osgisstack_scp_1</p></td>
</tr>
</tbody>
</table>
<p>The following ports will be accessible on the host to the docker services. You can, on a case by case basis, allow these through your firewall using ufw (uncomplicated firewall) to make them publicly accessible:</p>
<ol class="simple">
<li><p>80 - http:Only really needed during initial setup of your letsencrypt
certificate</p></li>
<li><p>443 - https: All web based services run through this port so that they are
encrypted</p></li>
<li><p>5432 - postgres: Only expose this publicly if you intend to allow remote
clients to access the postgres database.</p></li>
<li><p>2222 - scp: The is an scp/sftp upload mechanism to mobilise data and
resources to the web site</p></li>
</ol>
<p>For those services that are not exposed to the host,  they are generally made
available over 443/SSL via reverse proxy in the Nginx configuration.</p>
<p>Some things should still be configured manually and deployed after the initial
deployment:</p>
<ol class="simple">
<li><p>Mapproxy configuration</p></li>
<li><p>setup.sql (especially needed if you are planning to use postgrest)</p></li>
<li><p>Hugo content management</p></li>
<li><p>Landing page static HTML</p></li>
</ol>
<p>And some services are not intended to be used as long running services.
especially the ODM related services.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>We have written 2 make targets that automate the steps 1-10 described in the
overview above. Either target will ask you for your domain name, legitimate email address
and then go ahead and copy the templates over, replace placeholder domain names
and email address, generate passwords for postgres etc. and then run the
production stack. Remember you need to have ufw, rpl, make and pwgen installed
before running either of the commands below.</p>
<p>If you are going to use a self-signed certificate on a localhost (for testing) run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">configure</span><span class="o">-</span><span class="n">ssl</span><span class="o">-</span><span class="bp">self</span><span class="o">-</span><span class="n">signed</span>
</pre></div>
</div>
<p>If you are going to use a letsencrypt signed certificate on a name host (for production) run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">configure</span><span class="o">-</span><span class="n">letsencrypt</span><span class="o">-</span><span class="n">ssl</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">RIR Dashboard</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RIR Technical Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">RIR Roadmap</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">RIR Technical Documentation</a><ul>
  <li><a href="index.html">Installation</a><ul>
      <li>Previous: <a href="initial_configuration.html" title="previous chapter">Initial Configuration</a></li>
      <li>Next: <a href="../../roadmap.html" title="next chapter">RIR Roadmap</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Kartoza (Pty) Ltd..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/technical/installation/production_stack.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>